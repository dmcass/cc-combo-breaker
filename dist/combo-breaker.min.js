!function(e){"use strict";angular.module("cc-combo-breaker",[]).filter("ccComboFilter",function(){function e(e,t){return e.toLowerCase()===t.toLowerCase()?0:0===e.toLowerCase().indexOf(t.toLowerCase())?1:e.toLowerCase().indexOf(t.toLowerCase())>-1?2:void 0}return function(t,s){var o;return s?(o=t.filter(function(e){return e.toLowerCase().indexOf(s.toLowerCase())>-1}),o.sort(function(t,o){var i=e(t,s),c=e(o,s);return i===c?t.toLowerCase().localeCompare(o.toLowerCase()):i-c}),o):t}}).directive("combobreaker",["$document",function(t){return{restrict:"E",replace:!0,template:'<div class=cc-combo-wrapper><div class=cc-input-wrapper><input type=text class=cc-combo-input autocomplete=off ng-model=ccSearch placeholder={{placeholder}}> <span class=button></span></div><div class=cc-suggestions><ul class=cc-list><li ng-repeat="item in list | ccComboFilter: ccSearch | limitTo: ccLimit">{{item}}</li></ul></div></div>',scope:{list:"=",ngModel:"=",suggestionLimit:"@?",strict:"@?",placeholder:"@?"},link:function(s,o,i){var c=o.find("input[type=text]"),r=s.strict?"change":"input",l=o.find(".cc-list"),n=s.list.map(function(e){return e.toLowerCase()});s.strict?s.ngModel&&n.indexOf(s.ngModel.toLowerCase())>-1?s.ccSearch=s.ngModel:s.ccSearch="":s.ccSearch=s.ngModel,isNaN(s.suggestionLimit)||Number(s.suggestionLimit)<=1?s.ccLimit=1/0:s.ccLimit=parseInt(s.suggestionLimit,10),t.on("click",function(t){var s,i=e(t.target);o.hasClass("focus")?(s=o.find("li"),i.is(s)&&(c.val(i.text()).trigger(r).trigger("blur"),s.removeClass("selected")),i.is(c)||(o.removeClass("focus"),s.removeClass("selected"))):i.closest(o).length&&(o.addClass("focus"),c.trigger("focus"),o.find(".selected").length||o.find("li").first().addClass("selected"))}),o.on("mousedown",function(t){e(t.target).is(c)||t.preventDefault()}),l.on("mouseenter","li",function(t){var s=e(t.target);s.addClass("selected").siblings().removeClass("selected")}),c.on("focus",function(){o.hasClass("focus")||o.addClass("focus")}),c.on("keydown",function(e){var t,i,l,n=o.find(".cc-suggestions"),a=n.height(),d=o.find(".selected");27===e.which?""===c.val()?(c.val("").trigger(r).trigger("blur"),o.removeClass("focus")):(o.removeClass("focus"),c.val(s.ngModel).trigger(r).trigger("blur")):9===e.which||13===e.which?d.length&&(e.preventDefault(),c.val(d.text()).trigger(r).trigger("blur"),o.removeClass("focus")):38===e.which?(t=o.find("li").first(),d.is(t)||(d=d.removeClass("selected").prev().addClass("selected"),i=d.position(),l=d.outerHeight(),i.top<n.scrollTop()&&n.scrollTop(i.top))):40===e.which&&(t=o.find("li").last(),d.is(t)||(d=d.removeClass("selected").next().addClass("selected"),i=d.position(),l=d.outerHeight(),i.top+l>n.scrollTop()+a&&n.scrollTop(i.top+l-n.height())))}),c.on("input",function(){var e=o.find("li.selected");e.removeClass("selected"),o.find("li").first().addClass("selected"),s.strict||s.$apply(function(){s.ngModel=s.ccSearch})}),s.strict&&(c.on("change",function(){""===c.val()?(o.find("li").first().addClass("selected"),s.$apply(function(){s.ngModel=null})):n.indexOf(c.val().toLowerCase())>-1?s.$apply(function(){s.ngModel=s.ccSearch}):(o.addClass("cc-error"),c.val(s.ngModel).trigger(r))}),o.on("animationend",function(t){e(t.target).is(c)&&o.hasClass("cc-error")&&o.removeClass("cc-error")}))}}}])}(jQuery);