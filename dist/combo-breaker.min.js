!function(e){"use strict";angular.module("cc-combo-breaker",[]).filter("ccComboFilter",function(){function e(e,t){return e.toLowerCase()===t.toLowerCase()?0:0===e.toLowerCase().indexOf(t.toLowerCase())?1:e.toLowerCase().indexOf(t.toLowerCase())>-1?2:void 0}return function(t,i){var o;return i?(o=t.filter(function(e){return e.toLowerCase().indexOf(i.toLowerCase())>-1}),o.sort(function(t,o){var s=e(t,i),r=e(o,i);return s===r?t.toLowerCase().localeCompare(o.toLowerCase()):s-r}),o):t}}).directive("combobreaker",["$document",function(t){return{restrict:"E",replace:!0,template:'<div class=cc-combo-wrapper><input type=text class=cc-search-text autocomplete=off ng-model=ccSearch><div class=cc-input-wrapper><input type=text class=cc-combo-input autocomplete=off placeholder={{placeholder}}> <span class=button></span></div><div class=cc-suggestions><ul class=cc-list><li ng-repeat="item in list | ccComboFilter: ccSearch | limitTo: ccLimit">{{item}}</li></ul></div></div>',scope:{list:"=",ngModel:"=",suggestionLimit:"@?",strict:"@?",placeholder:"@?"},link:function(i,o,s){var r=o.find(".cc-combo-input"),c=o.find(".cc-search-text"),n=i.strict?"change":"input",l=o.find(".cc-list"),a=i.list.map(function(e){return e.toLowerCase()});i.strict?i.ngModel&&a.indexOf(i.ngModel.toLowerCase())>-1?r.val(i.ngModel):r.val(""):r.val(i.ngModel),isNaN(i.suggestionLimit)||Number(i.suggestionLimit)<=1?i.ccLimit=1/0:i.ccLimit=parseInt(i.suggestionLimit,10),t.on("mousedown",function(t){var i,s,c=e(t.target);o.hasClass("focus")?(i=o.find("li"),s=o.find(".button"),c.is(i)?r.val(c.text()).trigger(n).trigger("blur"):c.is(s)&&r.trigger(n).trigger("blur")):c.closest(o).length&&r.trigger("focus")}),o.on("mousedown",function(t){e(t.target).is(r)||t.preventDefault()}),l.on("mousemove","li",function(t){var i=e(t.target);i.addClass("selected").siblings().removeClass("selected")}),r.on("focus",function(){var t,s;o.addClass("focus"),i.$apply(function(){i.ccSearch=""}),setTimeout(function(){r.trigger("select")},50),o.find(".selected").length||(t=o.find("li"),s=t.filter(function(){return e(this).text().toLowerCase()===r.val().toLowerCase()}),s.length?s.addClass("selected"):t.first().addClass("selected"))}),r.on("blur",function(){var e=o.find(".cc-suggestions"),t=o.find("li");this.selectionStart=this.selectionEnd,o.removeClass("focus"),e.scrollTop(0),t.removeClass("selected")}),r.on("keydown",function(e){var t,s,c,l=o.find(".cc-suggestions"),a=l.height(),d=o.find(".selected");27===e.which?""===r.val()?r.val("").trigger(n).trigger("blur"):r.val(i.ngModel).trigger(n).trigger("blur"):9===e.which||13===e.which?d.length&&(e.preventDefault(),r.val(d.text()).trigger(n).trigger("blur")):38===e.which?(t=o.find("li").first(),d.is(t)||(d=d.removeClass("selected").prev().addClass("selected"),s=d.position(),c=d.outerHeight(),s.top<l.scrollTop()&&l.scrollTop(s.top))):40===e.which&&(t=o.find("li").last(),d.is(t)||(d=d.removeClass("selected").next().addClass("selected"),s=d.position(),c=d.outerHeight(),s.top+c>l.scrollTop()+a&&l.scrollTop(s.top+c-l.height())))}),r.on("input",function(){var e=o.find("li.selected");i.$apply(function(){i.ccSearch=r.val()}),e.removeClass("selected"),o.find("li").first().addClass("selected"),i.strict||i.$apply(function(){i.ngModel=i.ccSearch})}),i.strict&&(r.on("change",function(){""===r.val()?(o.find("li").first().addClass("selected"),i.$apply(function(){i.ngModel=null})):a.indexOf(r.val().toLowerCase())>-1?i.$apply(function(){i.ngModel=r.val()}):(o.addClass("cc-error"),r.val(i.ngModel).trigger(n),c.val(i.ngModel).trigger(n))}),o.on("animationend",function(t){e(t.target).is(r)&&o.hasClass("cc-error")&&o.removeClass("cc-error")}))}}}])}(jQuery);